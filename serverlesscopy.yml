service: aynitech-node-bithdaybot-manager

frameworkVersion: '2'

provider:
  name: aws
  stage: prod
  runtime: nodejs12.x
  description: test lambda con express y sls
  memorySize: 256 # optional, in MB, default is 1024
  lambdaHashingVersion: '20201221'
  timeout: 30 # optional, in seconds, default is 6
  profile: aynitech
  region: us-east-2
  deploymentBucket:
    name: lambda-deployment-us-east-2
    serverSideEncryption: AES256
    tags:
      - Key: Environment
        Value: production
      - Key: Module
        Value: Bithdaybot
      - Key: Project
        Value: RRHH
      - Key: Owner
        Value: cbueno@aynitech.com

functions:
  api:
    name: bithdaybot-api
    handler: api/lambda.handler
    events:
      - http:
          path: /
          method: GET
          cors: true
      - http:
          path: /
          method: POST
          cors: true
      - http:
          path: /{proxy+}
          method: ANY
          cors: true
    iamRoleStatements:
      - Effect: "Allow"
        Action:
          - "dynamodb:GetItem"
          - "dynamodb:Scan"
          - "dynamodb:Query"
          - "dynamodb:PutItem"
          - "dynamodb:UpdateItem"
          - "dynamodb:DeleteItem"
        Resource:
          - arn:aws:dynamodb:us-east-2:846656074263:table/aynitech_birthdays
          - arn:aws:dynamodb:us-east-2:846656074263:table/aynitech_announces
          - arn:aws:dynamodb:us-east-2:846656074263:table/aynitech_events
      - Effect: "Allow"
        Action:
          - "s3:PutObject"
          - "s3:DeleteObject"
        Resource:
          - arn:aws:s3:::aynitech-rrhh-images/*

  bot:
    name: bithdaybot
    handler: bot/lambda.handler
    runtime: python3.8
    events:
      - schedule:
          rate: cron(0 14 * * ? *)
          enabled: true
      - schedule:
          rate: cron(30 13 * * ? *)
          enabled: true
      - schedule:
          rate: cron(0 17 * * ? *)
          enabled: true
    iamRoleStatements:
      - Effect: "Allow"
        Action:
          - "dynamodb:Scan"
          - "dynamodb:GetItem"
        Resource:
          - arn:aws:dynamodb:us-east-2:846656074263:table/aynitech_birthdays
          - arn:aws:dynamodb:us-east-2:846656074263:table/aynitech_announces
          - arn:aws:dynamodb:us-east-2:846656074263:table/aynitech_events

plugins: 
  - serverless-iam-roles-per-function